[gcode_macro Test]
gcode:
     RUN_SHELL_COMMAND CMD=play_beep PARAMS=/home/pi/beep.wav

[gcode_macro DISABLE_FILAMENT_SENSOR]
gcode:
  {% set s = params.SENSOR|default('switch_sensor') %}
  {% set e = params.SENSOR|default('encoder_sensor') %}
  
  SET_FILAMENT_SENSOR SENSOR={s} ENABLE=0
  SET_FILAMENT_SENSOR SENSOR={e} ENABLE=0

[gcode_macro ENABLE_FILAMENT_SENSOR]
gcode:
  {% set s = params.SENSOR|default('switch_sensor') %}
  {% set e = params.SENSOR|default('encoder_sensor') %}
  
  SET_FILAMENT_SENSOR SENSOR={s} ENABLE=1
  SET_FILAMENT_SENSOR SENSOR={e} ENABLE=1

[gcode_macro Preheat_ABS]
gcode:
  M104 S{150}
  M190 S{100}

[gcode_macro Nozzle_Wipe]
gcode:
  G0 X15 Y339 Z23 F8000
  SET_SERVO SERVO=my_servo ANGLE=180
  G4 P500
  SET_SERVO SERVO=my_servo ANGLE=30
  G4 P300
  SET_SERVO SERVO=my_servo ANGLE=180
  G4 P300
  SET_SERVO SERVO=my_servo ANGLE=30
  G4 P300
  SET_SERVO SERVO=my_servo ANGLE=180
  G4 P300
  SET_SERVO SERVO=my_servo ANGLE=30
  G4 P300

  
  SET_SERVO SERVO=my_servo ANGLE=68
  G4 P300
  {% for i in range(5) %}
    G0 X7 Y339 Z20 F8000
    G0 X23 Y339 Z20 F8000
  {% endfor %}
  SET_SERVO SERVO=my_servo ANGLE=5
  G4 P500
  G0 X175 Y175 Z20 F8000
  
[quad_gantry_level]
gantry_corners:
	10,10
	340,340
points:
	25,25
	25,325
	325,325
	325,25
speed: 400
horizontal_move_z: 7
retries: 15
retry_tolerance: 0.01
max_adjust: 10

[bed_mesh]
speed: 300
horizontal_move_z: 5
mesh_min: 10,10
mesh_max: 340,340
probe_count: 10,10
algorithm: bicubic
bicubic_tension: 0.2

[adxl345] # Using Klipper Shake&Tune plugin for input shaping
cs_pin: EBBCan:gpio1
spi_software_sclk_pin: EBBCan:gpio2
spi_software_mosi_pin: EBBCan:gpio0
spi_software_miso_pin: EBBCan:gpio3

[resonance_tester]
probe_points: 175, 175, 20
accel_chip: adxl345

[pause_resume]

[output_pin Case_LEDs]
pin: PA3
pwm: true

shutdown_value: 0
value: 1.0


[gcode_macro Case_LEDs_On]
gcode:
  SET_PIN PIN=Case_LEDs VALUE=1
  UPDATE_DELAYED_GCODE ID=Case_LEDs_Timeout DURATION=300


[gcode_macro Case_LEDs_Off]
gcode:
  SET_PIN PIN=Case_LEDs VALUE=0

[delayed_gcode Case_LEDs_Timeout]
initial_duration: 300.
gcode:
  Case_LEDs_Off
  STATUS_OFF

[gcode_macro DISABLE_STEPPERS]
gcode:  
    STATUS_BUSY
    M84
    STATUS_READY

[gcode_macro CHANGE_FILAMENT]
gcode:
    {% if printer.toolhead.homed_axes != "xyz" %}
        G28
    {% endif %}
    
    STATUS_HEATING
    M109 S{200} #Heat nozzle before retracting
    STATUS_BUSY
    g92 e0
    G0 X175 Y0 Z100 F3000
    G1 E-50 F1000
    g92 e0
    G1 E-50 F1000
    g92 e0
    G1 E-50 F1000
    g92 e0
    G1 E-50 F1000
    STATUS_READY

[gcode_macro PARK]
gcode:
    STATUS_BUSY
    {% set th = printer.toolhead %}
    G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y//2} Z30  
    STATUS_READY

[gcode_macro Home_And_QGL]
gcode:
   STATUS_CALIBRATING_Z
   SAVE_GCODE_STATE NAME=STATE_G32
   G90
   G28
   QUAD_GANTRY_LEVEL
   G28
   PARK
   RESTORE_GCODE_STATE NAME=STATE_G32
   STATUS_READY


[gcode_macro OFF]
gcode:
    M84                                  ; turn steppers off
    TURN_OFF_HEATERS                     ; turn bed / hotend off
    M107                                 ; turn print cooling fan off

[gcode_macro M205]
gcode: